\begin{frame}
%damn tilde, best that i found
\def~{$\sim$}
	\frametitle{Инфраструктура для разработчика}
	
	\begin{itemize}
		\item Конфигурация
			\begin{enumerate}
				\item {\tt ~/.rpmmacros} -- информация о пакетировщике, локальные настройки
				\item {\tt ~/RPM/} -- дерево для внутреннего использования RPM
					\begin{enumerate}
						\item {\tt BUILD/}
						\item {\tt BUILDROOT/}
						\item {\tt RPMS/\%arch/}
						\item {\tt SOURCES/}
						\item {\tt SPECS/}
						\item {\tt SRPMS/}
					\end{enumerate}
			\end{enumerate}
		\item Исходники
			\begin{enumerate}
				\item Исходный код ПО 
				\item {\tt spec} -- файл описания процесса сборки, установки, а также метаинформация
				\item Патчи при необходимости
			\end{enumerate}

		\item На выходе
			\begin{enumerate}
				\item {\tt *.\%arch.rpm} -- пакеты, готовые для установки
				\item {\tt *.srpm} -- пакет с исходниками
			\end{enumerate}

	\end{itemize}
\end{frame}


\begin{frame}
	\frametitle{Структура типового spec-файла}

	\begin{itemize}
		\item Макросы -- {\tt \%define FOO bar}
		\item Заголовок (Тэги) -- {\tt Tag: value}
		\item Подготовка -- {\tt \%prep + \%setup}
		\item Сборка -- {\tt \%build}
		\item Проверка -- {\tt \%check}
		\item Установка -- {\tt \%install}
		\item Файлы --{\tt \%files}
		\item Скрипты, выполняемые в различных условиях\\
			{\tt pre-,post-install, uninstall, trigger}
		\item Изменения -- {\tt \%changelog }
	\end{itemize}

\end{frame}

\begin{frame}
	\frametitle{Зависимости}

	\begin{block}{ Зависимости}
		\begin{itemize}
			\item {\tt BuildRequires:}
			\item {\tt Requires:}
			\item {\tt Provides:}
			\item {\tt Conflicts:}
			\item {\tt Obsoletes:}
			\item {\tt AutoReqProv: (0|1)}
		\end{itemize}
	\end{block}

\end{frame}

\begin{frame}
	\frametitle{версии}

	\Large{Чтение правил дистрибутива строго обязательно!}

	Hint: {\tt rpmdev-vercmp (rpmdevtools)}
	\begin{block}{ Версия -- составная}
		{\tt \%name-\%epoch:\%version-\%release}
		\begin{itemize}
			\item {\tt \%name}
			\item {\tt \%epoch}
			\item {\tt \%version}
			\item {\tt \%release}
			\begin{itemize}
				\item Release:
				\item \%\{?dist\} tag
				\item rebuild number -- автоматически (при использовании нормальных билд-систем)
			\end{itemize}
		\end{itemize}
	\end{block}

\end{frame}



\begin{frame}
	\frametitle{Пример 1: Hello, World!}

	\begin{block}{Упражнение: hello.spec}
		\begin{itemize}
			\item Собрать пакет с помощью {\tt rpmbuild -ba hello.spec}
			\item Посмотреть список зависимостей {\tt rpm -qRp hello*.rpm}
			\item Установить полученный пакет
			\item Удалить исходники и spec-файл
			\item Пересобрать пакет из SRPM {\tt rpmbuild -{}-rebuild *.srpm}
		\end{itemize}
	\end{block}

	\pause

	\begin{block}{Упражнение: расширяем функционал}
		Добавить компиляцию, установку и пакетирование для CPP-примера.
	\end{block}

\end{frame}

\begin{frame}
	\frametitle{Пример 2}

	\begin{block}{Подпакеты, скрипты, зависимости и обновление}
		На примере {\tt template.spec}

		\begin{itemize}
			\item Собрать пакет с помощью {\tt rpmbuild -ba template.spec}
			\item Посмотреть список зависимостей {\tt rpm -qRp template*.rpm}
			\item Установить полученные пакеты
			\item Изменить версию, пересобрать и обновить в системе
			\item Удалить полученные пакеты
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Пример 3}

	\begin{block}{Задача:}
		Создать и установить пакеты для примера с созданием библиотек
		и их использования из предыдущих лекций.
	\end{block}

	Hint: libtestA, libtestB, libtestA-devel, libtestB-devel, mainpkg

\end{frame}

